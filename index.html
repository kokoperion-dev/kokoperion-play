<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ココペリの星</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <audio id="bgm" src="fail_bgm.mp3" loop></audio>

    <div id="game-container">
        <img id="kokopelli" src="kokopelli.png" alt="ココペリ">
        <img id="raccoon" src="raccoon.png" alt="アライグマ">
        <div id="background"></div>
        <div id="game-screen"></div>
        <div id="ui-overlay">
            <h1 id="title-text">ココペリの星</h1>
            <button id="start-button">ゲーム開始</button>
            <div id="result-message"></div>
            <button id="next-stage-button" class="hidden">次のステージへ</button>
            <button id="restart-button" class="hidden">はじめから</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
body {
    margin: 0;
    overflow: hidden;
    background-color: #000;
    font-family: sans-serif;
    color: #fff;
    text-align: center;
}

#game-container {
    position: relative;
    width: 100vw;
    height: 100vh;
}

#background {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('background.png');
    background-size: cover;
    z-index: -1;
}

#kokopelli {
    position: absolute;
    top: 5vh;
    left: 5vw;
    width: 150px;
    animation: kokopelli-rotate 3s infinite ease-in-out;
}

@keyframes kokopelli-rotate {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(15deg); }
}

#raccoon {
    position: absolute;
    bottom: 5vh;
    width: 150px;
    animation: raccoon-move 15s infinite ease-in-out alternate;
}

@keyframes raccoon-move {
    0% { left: 5vw; }
    100% { left: calc(95vw - 150px); }
}

#game-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.star {
    position: absolute;
    width: 30px;
    height: 30px;
    background-size: contain;
    animation-timing-function: linear;
    animation: star-fall-wave 3s linear forwards;
    cursor: pointer;
}

.star.normal {
    background-image: url('star_normal.png');
}

.star.rainbow {
    background-image: url('star_rainbow.png');
}

.star.diamond {
    background-image: url('diamond.png');
}

@keyframes star-fall-wave {
    0% { transform: translate(0, -10vh); opacity: 1; }
    100% { transform: translate(100px, 110vh); opacity: 0.5; }
}

#ui-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

button {
    font-size: 2em;
    padding: 10px 20px;
    cursor: pointer;
}

.hidden {
    display: none;
}
document.addEventListener('DOMContentLoaded', () => {
    const gameScreen = document.getElementById('game-screen');
    const startButton = document.getElementById('start-button');
    const nextStageButton = document.getElementById('next-stage-button');
    const restartButton = document.getElementById('restart-button');
    const resultMessage = document.getElementById('result-message');
    const bgm = document.getElementById('bgm');
    let currentStage = 0;
    let score = 0;
    
    const starSounds = {
        normal: new Audio('star_pop.mp3'),
        rainbow: new Audio('star_pop_rainbow.mp3'),
        diamond: new Audio('star_diamond_catch.mp3') // ファイル名を統一しました
    };

    const indianQuotes = [
        "ラムビー族の格言\n知識ではなく、智恵を求めよ。知識は産物だが、\n智恵は未来をもたらす。",
        "チェロキー族の格言\n日と夜、季節、星、太陽。その移ろいを見れば、\nひとより偉大な何かの存在を思わずにはいられない。",
        "ショショネ族の格言\n自分より偉大なものには、つねに畏敬の念をもて。",
        "ホピ族の格言\n善人にも、悪人にも雨は降り、陽は昇る。",
        "ラコタ族の格言\n創世記はいまも続いている。",
        "アパッチ族の格言\nまっすぐに、しゃべれば、光線のように、こころに届く",
        "ホピ族の格言\nかんしゃくを起こすと、友人を失う。嘘をつくと、自分自身を失う。",
        "オハマ族の伝承\n親切とは、言葉をつつしみ、人を傷つけないように心がけることだ。",
        "ホピ族の格言\n慎ましく食べ、慎んでしゃべる。そして誰も傷つけない。",
        "ソーク族の格言\n私の前を歩くな、私が従うとは限らない。私の後を歩くな、\n私が導くとは限らない。私と共に歩け、私たちはひとつなのだから。",
        "ミンカス族の格言\n感謝する理由がみつからなければ落ち度はあなた自身にある。",
        "ダコタ族の格言\n歩いた足跡でひとは永遠に知られる。",
        "ナバホ族の格言\n思考は矢のように放たれたら、的を射る。注意しないと\n自分の放った矢で倒れることになる。",
        "ホピ族の格言\n怒りは自分に盛る毒。",
        "ドゥワミッシュ族の格言\n死は存在しない生きる世界が変わるだけだ。",
        "シャイアン族の格言\n目で判断せずに、こころで判断しろ。",
        "オマハ族の格言\n過ちを見てそれを正そうとしなければ過ちを犯した者と同罪だ。",
        "ナバホ族\n素晴らしい夢を見てそれを行動に移せ。",
        "チェロキー族の格言\n昨日のことで今日を消耗させてはならない。",
        "オノンダガ族\n秘密などというものはない。謎などというものもない。それらはただの常識にすぎない。",
        "ホピ族の格言\n泣くことをおそれずに。泣くことは、悲しみにあふれたあなたのこころを解き放つ。",
        "オグララ・ラコタ族の格言\n真実の言葉とは、深くこころに沈んでそこにとどまるもの。",
        "オクラホマ族の格言\n飢えた人間は狼と一緒でも食べる。",
        "ホピ族の格言\n1本の指では小石すら持ち上げられぬ。",
        "アパッチ族の格言\n見た目のよい男というものが、ただ顔の造作がよいだけのこともある。",
        "オグララ・ラコタ族の格言\n宇宙はわれわれひちりひとりのなかにある。",
        "ラコタ族の格言\n貧乏は謙遜の首を縄で絞めながら、神と人間にたいする無礼を飼育する。",
        "モホーク族の格言\n人生はあげることと、もらうことの両方である。",
        "パウニー族の格言\n宗教はひとつのこらず神のもとに帰るための足がかりにすぎない。",
        "オマハ族の格言\nいのちあるものすべてにいたわりを。",
        "ドゥワミッシュ族の格言\nわたしが愛するのは、お金への愛に生きていない人たち。",
        "アラバホ族の格言\nあぶく銭は怠け者をつくる。",
        "ソーク族の格言\n師は教えることでまた学んでいる。",
        "ダコタ族の格言\n歩いた足跡でひとは永遠に知られる。",
        "アパッチ族の格言\n神の名は無意味、世界にとってほんとうの神はあいなのだ。",
        "アラバホ族の格言\n少しずつ少しずつ行けるところまで進む。",
        "ポウニー族の格言\n死はつねに季節はずれにやってくる。",
        "ナバホ族の格言\n素晴らしい夢を見てそれを行動に移せ。",
        "スー族の格言\nひとびとのこころに真の平和が宿るまで、国と国との間に平和はやってこない。",
        "イロコイ族の格言\nどんなことも7世代先まで考えて決めなければならない。"
    ];

    const starPoints = {
        'normal': 1,
        'rainbow': 2,
        'diamond': 5
    };

    const stageConfig = {
        1: {
            stars: 30,
            ratios: { normal: 0.9, rainbow: 0.1, diamond: 0 },
            clearScore: 30
        },
        2: {
            stars: 30,
            ratios: { normal: 0.5, rainbow: 0.5, diamond: 0 },
            clearScore: 40
        },
        3: {
            stars: 30,
            ratios: { normal: 0.2, rainbow: 0.7, diamond: 0.1 },
            clearScore: 60
        }
    };

    startButton.addEventListener('click', () => {
        bgm.play();
        startStage(1);
    });

    nextStageButton.addEventListener('click', () => {
        startStage(currentStage + 1);
    });

    restartButton.addEventListener('click', () => {
        bgm.pause();
        bgm.currentTime = 0;
        startStage(1);
    });

    function startStage(stageNumber) {
        currentStage = stageNumber;
        score = 0;
        gameScreen.innerHTML = '';
        resultMessage.textContent = '';
        startButton.classList.add('hidden');
        nextStageButton.classList.add('hidden');
        restartButton.classList.add('hidden');

        const config = stageConfig[stageNumber];
        const starPool = createStarPool(config.stars, config.ratios);

        let starCount = 0;
        const starInterval = setInterval(() => {
            if (starCount >= config.stars) {
                clearInterval(starInterval);
                checkResult();
                return;
            }
            createStar(starPool[starCount]);
            starCount++;
        }, 1000);
    }

    function createStarPool(totalStars, ratios) {
        const pool = [];
        const normalCount = Math.floor(totalStars * ratios.normal);
        const rainbowCount = Math.floor(totalStars * ratios.rainbow);
        const diamondCount = totalStars - normalCount - rainbowCount;

        for (let i = 0; i < normalCount; i++) pool.push('normal');
        for (let i = 0; i < rainbowCount; i++) pool.push('rainbow');
        for (let i = 0; i < diamondCount; i++) pool.push('diamond');

        return shuffleArray(pool);
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function createStar(starType) {
        const star = document.createElement('div');
        star.classList.add('star', starType);
        star.style.left = `${Math.random() * 90}vw`;
        gameScreen.appendChild(star);

        star.addEventListener('click', () => {
            const sound = starSounds[starType];
            if (sound) {
                sound.play();
            }
            score += starPoints[starType];
            star.remove();
        });
    }

    function checkResult() {
        const requiredScore = stageConfig[currentStage].clearScore;

        if (score >= requiredScore) {
            if (currentStage < 3) {
                resultMessage.textContent = "ステージクリア！";
                nextStageButton.classList.remove('hidden');
            } else {
                resultMessage.textContent = "ゲームクリア！";
                restartButton.classList.remove('hidden');
            }
        } else {
            const randomQuote = indianQuotes[Math.floor(Math.random() * indianQuotes.length)];
            resultMessage.textContent = randomQuote;
            restartButton.classList.remove('hidden');
        }
    }
});
